<!-- src/app/TIENDA-ONLINE/components/cart/cart.component.html -->

<div class="cart-sidebar-container" (click.self)="onClose()">
  <div class="cart-sidebar" style="background-color: white;">
    
    <div class="cart-sidebar-header">
      <h2>Mi Carrito</h2>
      <button (click)="onClose()" class="close-btn" aria-label="Cerrar carrito">&times;</button>
    </div>

    <ng-container *ngIf="cartItems$ | async as cartItems">
      
      <div *ngIf="cartItems.length === 0; else cartHasItems" class="empty-cart-container">
        <div class="empty-cart-icon">
          <i class="fas fa-shopping-bag"></i>
        </div>
        <h3>Tu carrito está vacío</h3>
        <p>Los productos que añadas aparecerán aquí.</p>
        <button (click)="onClose()" class="start-shopping-btn">Seguir Comprando</button>
      </div>

      <ng-template #cartHasItems>
        <div class="cart-sidebar-body">
          <div *ngFor="let item of cartItems; trackBy: trackByCartItemId" class="cart-item-card">
            <div class="item-image-container">
              <img [src]="productService.getImageUrl(item.product.foto)" [alt]="item.product.nombre" class="item-image">
            </div>

            <div class="item-details-container">
              <div class="item-info">
                <span class="item-name">{{ item.product.nombre }}</span>
                <!-- TALLA MEJORADA -->
                <span class="item-size">
                  Talla: {{ item.selectedSize.eur }} EUR / {{ item.selectedSize.usa }} US / {{ item.selectedSize.cm }} CM
                </span>
              </div>
              <div class="item-controls">
                <span class="item-price">{{ item.product.precioVenta | currency:'S/' }}</span>
                <div class="quantity-selector">
                  <button (click)="onUpdateQuantity(item.id, item.quantity - 1)" [disabled]="item.quantity <= 1">-</button>
                  <span>{{ item.quantity }}</span>
                  <button (click)="onUpdateQuantity(item.id, item.quantity + 1)" [disabled]="item.quantity >= item.selectedSize.stock">+</button>
                </div>
              </div>
            </div>

            <div class="item-remove-container">
              <button (click)="onRemoveItem(item.id)" class="remove-btn" aria-label="Eliminar producto">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- RESUMEN DE COMPRA MEJORADO -->
        <div class="cart-sidebar-footer">
          <div class="summary-details">
            <div class="summary-row">
              <span>Subtotal</span>
              <span>{{ subtotal$ | async | currency:'S/' }}</span>
            </div>
            <div class="summary-row">
              <span>Descuento</span>
              <span>- {{ 0 | currency:'S/' }}</span>
            </div>
            <div class="summary-row">
              <span>Costo de Envío</span>
              <span class="shipping-cost">{{ shippingCost$ | async | currency:'S/' }}</span>
            </div>
          </div>
          <div class="summary-total">
            <span>Total</span>
            <span class="total-price">{{ totalPrice$ | async | currency:'S/' }}</span>
          </div>
          <!-- CAMBIO CLAVE: El botón ahora llama a nuestra función proceedToCheckout() -->
          <button class="checkout-btn" (click)="proceedToCheckout()">Finalizar Compra</button>
        </div>
      </ng-template>

    </ng-container>
  </div>
</div>

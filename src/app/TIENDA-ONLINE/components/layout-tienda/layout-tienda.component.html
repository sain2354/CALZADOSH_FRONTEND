<!-- layout-tienda.component.html -->
<header class="site-header" role="banner">
  <div class="header-container">
    <div class="header-left">
      <a routerLink="/" class="logo" aria-label="Ir a inicio">
        <img src="assets/images/LOGO.png" alt="Logo de la Tienda">
      </a>
    </div>

    <div class="header-center" (mouseleave)="onHoverCategory(null)">
      <nav class="main-nav" aria-label="Navegación principal">
        <button class="nav-btn"
                (click)="selectCategory('Todos')"
                (mouseenter)="onHoverCategory(null)"
                [class.active]="selectedCategoryName === 'Todos'">
          Todos
        </button>

        <div class="nav-item-with-dropdown"
             (mouseenter)="onHoverCategory('Hombres')"
             (mouseleave)="onHoverCategory(null)">
          <button class="nav-btn" (click)="selectCategory('Hombres')" [class.active]="selectedCategoryName === 'Hombres'">
            Hombres
          </button>
        </div>

        <!-- Mujeres -->
        <div class="nav-item-with-dropdown"
             (mouseenter)="onHoverCategory('Mujeres')"
             (mouseleave)="onHoverCategory(null)">
          <button class="nav-btn" (click)="selectCategory('Mujeres')" [class.active]="selectedCategoryName === 'Mujeres'">
            Mujeres
          </button>
        </div>

        <!-- Infantil -->
        <div class="nav-item-with-dropdown"
             (mouseenter)="onHoverCategory('Infantil')"
             (mouseleave)="onHoverCategory(null)">
          <button class="nav-btn" (click)="selectCategory('Infantil')" [class.active]="selectedCategoryName === 'Infantil'">
            Infantil
          </button>
        </div>
      </nav>
    </div>

    <div class="header-right" role="navigation" aria-label="Acciones">
      <form (submit)="onSearch()" class="search-form" role="search" aria-label="Buscar productos">
        <input type="search" name="q" placeholder="BUSCAR" [(ngModel)]="searchTerm" (keydown.enter)="onSearch()" />
        <button type="button" class="search-btn" (click)="onSearch()" aria-label="Buscar">
          <i class="fas fa-search"></i>
        </button>
      </form>

      <!-- ====== INICIO DE LA MODIFICACIÓN PRECISA (VERSIÓN CLICK) ====== -->
      <div class="user-menu-container">
        <button class="header-icon user-icon-btn" (click)="toggleUserMenu()" aria-label="Menú de usuario">
          <i class="fas" [class.fa-user]="!(currentUser$ | async)" [class.fa-user-check]="!!(currentUser$ | async)"></i>
        </button>
        
        <div class="user-dropdown" *ngIf="isUserMenuOpen">
          <ng-container *ngIf="currentUser$ | async as user; else showLoginButton">
            <!-- Contenido para usuario LOGUEADO -->
            <div class="user-info">
              <p>Conectado como:</p>
              <strong>{{ user.email }}</strong>
            </div>
            <hr>
            <a routerLink="/mis-pedidos" class="user-dropdown-btn" (click)="toggleUserMenu()">Mis Pedidos</a>
            <a routerLink="/favoritos" class="user-dropdown-btn" (click)="toggleUserMenu()">Mis Favoritos</a>
            <button class="user-dropdown-btn" (click)="onSignOut()">Cerrar Sesión</button>
          </ng-container>

          <ng-template #showLoginButton>
            <!-- Contenido para usuario NO logueado -->
            <button class="user-dropdown-btn" (click)="goToLogin()">Iniciar Sesión</button>
          </ng-template>
        </div>
      </div>
      <!-- ====== FIN DE LA MODIFICACIÓN PRECISA ====== -->
      
      <button (click)="setCartVisible(!isCartVisible)" class="header-icon cart-icon-link" aria-label="Abrir o cerrar carrito">
        <i class="fas fa-shopping-bag"></i>
        <ng-container *ngIf="cartItemCount$ | async as count">
          <span *ngIf="count > 0" class="cart-badge">{{ count }}</span>
        </ng-container>
      </button>
    </div>
  </div>
</header>

<!-- === MODIFICACIÓN: Se elimina la clase 'content-shell' para arreglar el scroll === -->
<main class="main-content" role="main">
  <router-outlet></router-outlet>
</main>

<!-- ====================================================================== -->
<!-- =================== INICIO DEL NUEVO FOOTER MEJORADO =================== -->
<!-- ====================================================================== -->
<footer class="site-footer" role="contentinfo">
  <div class="footer-container">
    <div class="footer-main">
      <!-- Columna 1: Soporte -->
      <div class="footer-column">
        <h4 class="footer-heading">Soporte</h4>
        <ul class="footer-links">
          <li><a routerLink="/preguntas-frecuentes">Preguntas Frecuentes</a></li>
          <li><a routerLink="/politica-de-envios">Política de Envíos</a></li>
          <li><a routerLink="/politica-de-cambios">Cambios y Devoluciones</a></li>
          <li><a routerLink="/contacto">Contáctanos</a></li>
        </ul>
      </div>

      <!-- Columna 2: Legal -->
      <div class="footer-column">
        <h4 class="footer-heading">Legal</h4>
        <ul class="footer-links">
          <li><a routerLink="/terminos">Términos y Condiciones</a></li>
          <li><a routerLink="/privacidad">Política de Privacidad</a></li>
          <li><a routerLink="/libro-reclamaciones">Libro de Reclamaciones</a></li>
        </ul>
      </div>
      
      <!-- Columna 3: Empresa -->
      <div class="footer-column">
        <h4 class="footer-heading">Empresa</h4>
        <ul class="footer-links">
          <li><a routerLink="/sobre-nosotros">Sobre Nosotros</a></li>
          <li><p class="company-details"><strong>RUC:</strong> 2006250858</p></li>
          <li><p class="company-details"><strong>Razón Social:</strong> FUTURE VISIONS GALAXY S.C.R.L.</p></li>
        </ul>
      </div>

      <!-- Columna 4: Síguenos y Métodos de Pago -->
      <div class="footer-column">
        <h4 class="footer-heading">Síguenos</h4>
        <div class="social-icons">
          <a href="https://www.facebook.com" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
          <a href="https://www.instagram.com" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          <a href="https://www.tiktok.com" target="_blank" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
        </div>
        <h4 class="footer-heading payment-heading">Paga Seguro</h4>
        <div class="payment-icons">
          <i class="fab fa-cc-visa"></i>
          <i class="fab fa-cc-mastercard"></i>
          <i class="fab fa-cc-paypal"></i>
          <i class="fab fa-cc-amex"></i>
        </div>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>FUTURE VISIONS © 2024, ALL RIGHTS RESERVED</p>
    </div>
  </div>
</footer>
<!-- ====================================================================== -->
<!-- ==================== FIN DEL NUEVO FOOTER MEJORADO ===================== -->
<!-- ====================================================================== -->

<app-cart *ngIf="isCartVisible" (close)="setCartVisible(false)"></app-cart>

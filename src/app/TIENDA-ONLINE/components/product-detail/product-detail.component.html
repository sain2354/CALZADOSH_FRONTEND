<!-- BOTÓN PARA VOLVER ATRÁS -->
<button (click)="goBack()" class="back-button">
  <i class="bi bi-arrow-left"></i>
</button>

<!-- NOTIFICACIÓN DE ÉXITO -->
<div class="success-notification" [class.show]="showSuccessMessage">
  <i class="bi bi-check-circle-fill"></i>
  ¡Agregado al carrito!
</div>

<div class="detail-container" *ngIf="product; else loading">
  <div class="main-content">
    <!-- Columna de la Imagen -->
    <div class="image-column">
      <div class="image-card">
        <img [src]="productService.getImageUrl(product.foto)" [alt]="product.nombre" class="product-image">
      </div>
    </div>

    <!-- Columna de Detalles -->
    <div class="details-column">
      <div class="details-card">
        <!-- Botón de Favorito -->
        <button (click)="toggleFavorite()" class="favorite-btn" [class.favorited]="isFavorite">
          <i class="bi" [class.bi-heart-fill]="isFavorite" [class.bi-heart]="!isFavorite"></i>
        </button>

        <!-- Metadatos del Producto -->
        <div class="product-meta">
          <span>{{ product.subCategoriaDescripcion }}</span>
          <span class="discount-badge">-28%</span>
        </div>

        <!-- Nombre del Producto -->
        <h1 class="product-name">{{ product.nombre }}</h1>

        <!-- Precios -->
        <div class="price-container">
          <p class="original-price">{{ originalPrice | currency:'S/':'symbol':'1.2-2' }}</p>
          <p class="final-price">{{ product.precioVenta | currency:'S/':'symbol':'1.2-2' }}</p>
        </div>

        <!-- Selector de Tallas -->
        <div class="size-selector" *ngIf="product.tallas && product.tallas.length > 0">
          <label for="size-dropdown" class="size-label">Tallas disponibles:</label>
          <select id="size-dropdown" [(ngModel)]="selectedSize" (change)="onSizeChange()" class="size-dropdown">
            <option [ngValue]="null" disabled>Seleccione una talla</option>
            <option *ngFor="let talla of product.tallas" [ngValue]="talla" [disabled]="talla.stock <= 0">
              {{ 'USA ' + talla.usa + '  ·  EUR ' + talla.eur + '  ·  CM ' + talla.cm }}
              <span *ngIf="talla.stock <= 0"> (Agotado)</span>
            </option>
          </select>
          <div *ngIf="selectedSize && selectedSize.stock > 0" class="stock-info">
            <p>Stock disponible: {{ selectedSize.stock }}</p>
          </div>
        </div>
        <div *ngIf="!product.tallas || product.tallas.length === 0" class="no-stock-message">
          <p>Este producto no tiene tallas disponibles.</p>
        </div>

        <!-- Botones de Acción -->
        <div class="action-buttons">
          <button class="btn-add-to-cart" (click)="addToCart()" [disabled]="!isAddToCartEnabled()">
            <i class="bi bi-cart-plus-fill"></i> AGREGAR AL CARRITO
          </button>
          <button class="btn-size-guide" (click)="showSizeGuide()">
            GUÍA DE TALLAS
          </button>
        </div>
      </div>

      <!-- Acordeón de Características -->
      <div class="features-accordion">
        <div class="accordion-item">
          <h2 class="accordion-header" (click)="toggleAccordion('caracteristicas')">
            <button type="button" class="accordion-button" [class.collapsed]="!accordion['caracteristicas']">
              Características
            </button>
          </h2>
          <div class="accordion-collapse" [class.show]="accordion['caracteristicas']">
            <div class="accordion-body">
              <ul>
                <li><strong>Marca:</strong><span>{{ product.subCategoriaDescripcion || 'No especificado' }}</span></li>
                <li><strong>Categoría:</strong><span>{{ product.categoriaDescripcion || 'No especificada' }}</span></li>
                <li><strong>Material:</strong><span>{{ product.material || 'No especificado' }}</span></li>
                <li><strong>Color:</strong><span>{{ product.color || 'No especificado' }}</span></li>
                <li><strong>MPN:</strong><span>{{ product.mpn || 'No disponible' }}</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Modal para la Guía de Tallas -->
<div class="size-guide-modal" *ngIf="showSizeGuideModal" (click)="closeSizeGuide()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-modal-btn" (click)="closeSizeGuide()">×</button>
    <img [src]="getSizeGuideImage()" alt="Guía de tallas">
  </div>
</div>

<!-- Estado de Carga -->
<ng-template #loading>
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Cargando detalles del producto...</p>
  </div>
</ng-template>

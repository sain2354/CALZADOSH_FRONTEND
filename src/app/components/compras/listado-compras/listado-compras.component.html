<div class="card shadow-sm mt-4 small-view">
  <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
    <h6 class="mb-0">Listado de Compras</h6>
    
      
    
  </div>

  <div class="card-body">
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="fechaInicio" class="form-label">Fecha Inicio:</label>
        <input type="date" id="fechaInicio" class="form-control form-control-sm" [(ngModel)]="fechaInicio" />
      </div>
      <div class="col-md-3">
        <label for="fechaFin" class="form-label">Fecha Fin:</label>
        <input type="date" id="fechaFin" class="form-control form-control-sm" [(ngModel)]="fechaFin" />
      </div>

      <div class="col-md-4 offset-md-2 d-flex align-items-end justify-content-end">
        <div class="d-flex align-items-center w-100 justify-content-end">
          <!-- Eliminado autocomplete — queda solo el buscador simple -->
          <div class="d-flex align-items-center ms-3">
            <label for="buscarTabla" class="me-2 mb-0">Buscar:</label>
            <input type="text" id="buscarTabla" class="form-control form-control-sm w-auto"
                   [(ngModel)]="filtro" (input)="aplicarFiltro()">
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between mb-2 align-items-center flex-wrap">
      <div class="btn-group mb-2 mb-md-0">
        <button class="btn btn-sm btn-success me-1" (click)="exportarExcel()">
          <i class="fas fa-file-excel fa-sm"></i> Exportar Excel
        </button>
        <button class="btn btn-sm btn-dark me-1" (click)="imprimir()">
          <i class="fas fa-print fa-sm"></i> Imprimir
        </button>
        <select class="form-select form-select-sm w-auto" [value]="itemsPerPage" (change)="onItemsPerPageChange($event)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center small-table">
        <thead class="table-info">
          <tr>
            <th>ID Compra</th>
            <th>Fecha</th>
            <th>Proveedor</th>
            <th>Documento</th>
            <th>Total</th>
            <th>Opciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let compra of compras | paginate: { itemsPerPage: itemsPerPage, currentPage: p }">
            <td>{{ compra.idCompra }}</td>
            <td>{{ compra.fechaCompra | date:'shortDate' }}</td>
            <td>{{ compra.nombreProveedor }}</td>
            <td>{{ compra.tipoDocumento }} - {{ compra.numeroDocumento }}</td>
            <td>s/ {{ compra.total | number:'1.2-2' }}</td>
            <td>
              <button class="btn btn-info btn-sm" title="Ver Detalles" (click)="verDetalleCompra(compra.idCompra)">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-danger btn-sm" title="Eliminar" (click)="confirmarEliminar(compra.idCompra)">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="compras.length === 0">
            <td colspan="6">No hay información en esta tabla</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between mt-2 small-text align-items-center">
      <div>
        Registros del ({{ startRecord > 0 ? startRecord : 0 }} al {{ endRecord }}) total de {{ compras.length }} registros (orig: {{ comprasOriginal.length }})
      </div>
      <div class="d-flex align-items-center">
        <pagination-controls (pageChange)="p = $event"></pagination-controls>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Detalle de la Compra (sin cambios funcionales) -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': mostrarModalDetalle ? 'block' : 'none'}">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalle de la Compra</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="cerrarModalDetalle()"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="compraSeleccionadaDetalle">
          <div class="row">
            <div class="col-md-6">
              <p><strong>Proveedor:</strong> {{ compraSeleccionadaDetalle.nombreProveedor }}</p>
              <p><strong>Tipo Documento:</strong> {{ compraSeleccionadaDetalle.tipoDocumento }}</p>
              <p><strong>Número Documento:</strong> {{ compraSeleccionadaDetalle.numeroDocumento }}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Fecha:</strong> {{ compraSeleccionadaDetalle.fechaCompra | date:'shortDate' }}</p>
              <p><strong>Forma Pago:</strong> {{ compraSeleccionadaDetalle.formaPago }}</p>
            </div>
          </div>

          <h6>Ítems de la Compra:</h6>
          <div class="table-responsive">
            <table class="table table-bordered table-striped table-sm">
              <thead>
                <tr>
                  <th>Descripción</th>
                  <th>Talla</th>
                  <th>Precio U.</th>
                  <th>Cantidad</th>
                  <th>Sub Total</th>
                  <th>Stock</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of compraSeleccionadaDetalle.itemsCompra">
                  <td>{{ item.nombreProducto }}</td>
                  <td>{{ item.nombreTalla }}</td>
                  <td>s/ {{ item.precioUnitario | number:'1.2-2' }}</td>
                  <td>{{ item.cantidad }}</td>
                  <td>s/ {{ item.subtotal | number:'1.2-2' }}</td>
                  <td>{{ item.stock }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="row justify-content-end mt-3">
            <div class="col-md-4">
              <p><strong>SUBTOTAL:</strong> s/ {{ compraSeleccionadaDetalle.subtotal | number:'1.2-2' }}</p>
              <p><strong>IGV:</strong> s/ {{ compraSeleccionadaDetalle.igv | number:'1.2-2' }}</p>
              <p><strong>TOTAL:</strong> s/ {{ compraSeleccionadaDetalle.total | number:'1.2-2' }}</p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cerrarModalDetalle()">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Confirmación Eliminación (estilo imagen) -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': mostrarModalConfirm ? 'block' : 'none'}">
  <div class="modal-dialog modal-md modal-dialog-centered" role="document">
    <div class="modal-content confirm-modal">
      <div class="modal-body text-center">
        <div class="confirm-icon">
          <div class="icon-circle">
            <i class="fas fa-exclamation"></i>
          </div>
        </div>
        <h4 class="mt-3">¿Está seguro que desea eliminar este registro?</h4>
        <p class="text-muted small">Esta operación es irreversible</p>

        <div class="d-flex justify-content-center mt-3 gap-2">
          <button type="button" class="btn btn-outline-secondary btn-lg" (click)="cancelarEliminar()">Cancelar</button>
          <button type="button" class="btn btn-danger btn-lg" (click)="confirmarEliminarAccion()">Eliminar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Éxito Eliminación -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': mostrarModalSuccess ? 'block' : 'none'}">
  <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
    <div class="modal-content text-center p-3 success-modal">
      <div class="modal-body">
        <div class="check-icon mb-3">
          <i class="fas fa-check-circle fa-3x text-success"></i>
        </div>
        <h5>El registro fue eliminado correctamente</h5>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-primary" (click)="cerrarModalSuccess()">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<div class="card listado-ventas-container">
  <div class="card-header header-titulo">
    <h4 class="mb-0">Listado de Ventas</h4>
  </div>

  <div class="card-body">

    <div class="row mb-2 align-items-end">
      <div class="col-md-3">
        <label for="fechaInicio" class="form-label">Fecha Inicio:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-calendar"></i></span>
          <input
            type="date"
            id="fechaInicio"
            class="form-control form-control-sm"
            [(ngModel)]="fechaInicio" />
        </div>
      </div>

      <div class="col-md-3">
        <label for="fechaFin" class="form-label">Fecha Fin:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-calendar"></i></span>
          <input
            type="date"
            id="fechaFin"
            class="form-control form-control-sm"
            [(ngModel)]="fechaFin" />
        </div>
      </div>

      <div class="col-md-6"></div>
    </div>

    <div class="d-flex justify-content-between mb-3 acciones-rapidas">
      <div class="botones-export">
        <button
          class="btn btn-secondary btn-sm"
          title="Imprimir"
          (click)="imprimir()">
          <i class="fa fa-print"></i>
        </button>
      </div>

      <div class="d-flex align-items-center">
        <span class="me-2 text-secondary fw-semibold" style="font-size: 0.85rem;">Mostrar:</span>
        <select
          class="form-select form-select-sm me-3"
          style="width: 70px;" [(ngModel)]="cantidadPorPagina">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>

        <div class="input-group input-group-sm" style="width: 200px;">
          <span class="input-group-text"><i class="fa fa-search"></i></span>
          <input
            type="text"
            class="form-control"
            placeholder="Buscar..."
            [(ngModel)]="textoBusqueda" />
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-hover table-bordered align-middle table-sm">
        <thead class="table-encabezado">
          <tr>
            <th class="text-center">Cliente</th>
            <th class="text-center">Comprobante</th>
            <th class="text-center">Correlativo</th>
            <th class="text-center">Monto</th>
            <th class="text-center">Fecha</th>
            <th class="text-center">Usuario</th>
            <th class="text-center">Estado</th>
            <th class="text-center">Opciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="ventas.length === 0">
            <td colspan="8" class="text-center text-muted py-3">
              No hay información en esta tabla
            </td>
          </tr>
          <tr *ngFor="let venta of ventas | paginate: { itemsPerPage: cantidadPorPagina, currentPage: paginaActual }">
              <td class="text-center">{{ venta.clienteNombre || 'N/A' }}</td>
              <td class="text-center">{{ venta.tipoComprobante }}</td>
              <td class="text-center">{{ venta.serie }}-{{ venta.numeroComprobante }}</td>
              <td class="text-center">S/ {{ venta.total | number:'1.2-2' }}</td>
              <td class="text-center">{{ venta.fecha | date:'dd/MM/yyyy hh:mm:ss a' }}</td>
              <td class="text-center">{{ venta.usuarioNombre || 'N/A' }}</td>
              <td class="text-center">
                  <span class="badge"
                      [ngClass]="{
                          'bg-success': venta.estado === 'REGISTRADA',
                          'bg-danger': venta.estado === 'ANULADA',
                          'bg-warning': venta.estado === 'PENDIENTE'
                      }">
                      {{ venta.estado }}
                  </span>
              </td>
              <td class="text-center opciones-columna">
                  <button class="btn btn-info btn-sm me-1" title="Ver Detalle" (click)="verDetalle(venta)">
                      <i class="fa fa-eye"></i>
                  </button>
                  <button class="btn btn-danger btn-sm" title="Anular Venta" (click)="anularVenta(venta)">
                      <i class="fa fa-ban"></i>
                  </button>
              </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-center mt-3">
      <pagination-controls 
        previousLabel="Anterior"
        nextLabel="Siguiente"
        (pageChange)="paginaActual = $event"
        [maxSize]="5"
        [responsive]="true"
        class="pagination-sm">
      </pagination-controls>
    </div>

  </div>
</div>

<div class="modal fade" tabindex="-1" [ngClass]="{'show d-block': mostrarModalDetalle}" id="modalDetalleVenta" role="dialog" aria-labelledby="modalDetalleVentaLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="modalDetalleVentaLabel">
          <i class="fa fa-receipt me-2"></i>Detalle de Venta
        </h5>
        <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="cerrarModalDetalle()"></button>
      </div>
      <div class="modal-body p-4" *ngIf="ventaSeleccionadaParaDetalle">
        <div class="row mb-4">
          <div class="col-md-6 d-flex align-items-center">
            <span class="form-label fw-semibold text-secondary me-2 mb-0">Cliente:</span>
            <div class="form-control-plaintext border-bottom pb-2">{{ventaSeleccionadaParaDetalle.cliente?.nombreCompleto || 'N/A'}}</div>
          </div>
          <div class="col-md-6 d-flex align-items-center">
            <span class="form-label fw-semibold text-secondary me-2 mb-0">Fecha:</span>
            <div class="form-control-plaintext border-bottom pb-2">{{ventaSeleccionadaParaDetalle.fecha | date:'dd/MM/yyyy hh:mm:ss a'}}</div>
          </div>
        </div>
        
        <div class="row mb-4">
          <div class="col-md-4 d-flex align-items-center">
            <span class="form-label fw-semibold text-secondary me-2 mb-0">Tipo Comprobante:</span>
            <div class="form-control-plaintext border-bottom pb-2">{{ventaSeleccionadaParaDetalle.tipoComprobante}}</div>
          </div>
          <div class="col-md-4 d-flex align-items-center">
            <span class="form-label fw-semibold text-secondary me-2 mb-0">Correlativo:</span>
            <div class="form-control-plaintext border-bottom pb-2">{{ventaSeleccionadaParaDetalle.serie + '-' + ventaSeleccionadaParaDetalle.numeroComprobante}}</div>
          </div>
          <div class="col-md-4 d-flex align-items-center">
            <span class="form-label fw-semibold text-secondary me-2 mb-0">Forma de Pago:</span>
            <div class="form-control-plaintext border-bottom pb-2">Efectivo</div>
          </div>
        </div>
        
        <h6 class="mt-4 mb-3 border-bottom pb-2 fw-semibold text-primary">
          <i class="fa fa-list-alt me-2"></i>Detalles de Productos
        </h6>
        
        <div class="table-responsive">
          <table class="table table-bordered table-hover table-sm">
            <thead class="table-light">
              <tr>
                <th class="text-center">Descripción</th>
                <th class="text-center">Precio</th>
                <th class="text-center">Cantidad</th>
                <th class="text-center">Sub. Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngIf="!ventaSeleccionadaParaDetalle.detalles || ventaSeleccionadaParaDetalle.detalles.length === 0">
                <td colspan="4" class="text-center text-muted py-3">No hay detalles para esta venta.</td>
              </tr>
              <tr *ngFor="let detalle of ventaSeleccionadaParaDetalle.detalles">
                <td>{{ detalle.nombreProducto }} - Talla: {{ detalle.talla }}</td>
                <td class="text-end">S/ {{ detalle.precio | number:'1.2-2' }}</td>
                <td class="text-center">{{ detalle.cantidad }}</td>
                <td class="text-end">S/ {{ detalle.total | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="row justify-content-end mt-4">
          <div class="col-md-6">
            <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
              <span class="fw-semibold text-secondary">SUBTOTAL:</span>
              <span class="fw-semibold">S/ {{ventaSeleccionadaParaDetalle.total - (ventaSeleccionadaParaDetalle.totalIgv || 0) | number:'1.2-2'}}</span>
            </div>
            <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
              <span class="fw-semibold text-secondary">IGV:</span>
              <span class="fw-semibold">S/ {{ventaSeleccionadaParaDetalle.totalIgv || 0 | number:'1.2-2'}}</span>
            </div>
            <div class="d-flex justify-content-between align-items-center py-2">
              <span class="fw-bold text-primary">TOTAL:</span>
              <span class="fw-bold text-primary">S/ {{ventaSeleccionadaParaDetalle.total | number:'1.2-2'}}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer bg-light">
      </div>
    </div>
  </div>
</div>
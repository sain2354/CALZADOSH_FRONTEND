<!-- src/app/components/persona/nuevo-persona/persona.component.html -->
<h4 *ngIf="!esEdicion">Registrar Persona</h4>
<h4 *ngIf="esEdicion">Editar Persona</h4>
<hr />

<!-- Tipo Persona (Cliente / Proveedor) -->
<div class="form-group mb-2">
  <label>Tipo Persona <span class="text-danger">*</span></label>
  <select class="form-control" [(ngModel)]="persona.tipoPersona" (change)="onTipoPersonaChange()">
    <option>Cliente</option>
    <option>Proveedor</option>
  </select>
</div>

<!-- Tipo Documento (DNI si Cliente; RUC si Proveedor) -->
<div class="form-group mb-2">
  <label>Tipo Doc <span class="text-danger">*</span></label>
  <select class="form-control" [(ngModel)]="persona.tipoDocumento" disabled>
    <option>DNI</option>
    <option>RUC</option>
  </select>
  <small class="form-text text-muted">
    {{ persona.tipoPersona === 'Cliente' ? 'DNI (8 dígitos)' : 'RUC (11 dígitos)' }}
  </small>
</div>

<!-- Campo Documento con botón de consulta -->
<div class="form-group mb-2">
  <label>
    {{ persona.tipoPersona === 'Cliente' ? 'Documento (DNI)' : 'Número de RUC' }} 
    <span class="text-danger">*</span>
  </label>
  <div class="input-group">
    <input
      type="text"
      class="form-control"
      [(ngModel)]="persona.numeroDocumento"
      [placeholder]="persona.tipoPersona === 'Proveedor' ? 'Ingrese 11 dígitos' : 'Ingrese 8 dígitos'"
      [maxlength]="persona.tipoPersona === 'Proveedor' ? 11 : 8"
    />
    <button 
      class="btn btn-outline-primary" 
      type="button"
      (click)="consultarDocumento()"
      [disabled]="consultando || !persona.numeroDocumento || 
        (persona.tipoPersona === 'Cliente' && persona.numeroDocumento.length !== 8) ||
        (persona.tipoPersona === 'Proveedor' && persona.numeroDocumento.length !== 11)"
    >
      <span *ngIf="consultando" class="spinner-border spinner-border-sm" role="status"></span>
      {{ consultando ? 'Consultando...' : 'Consultar' }}
    </button>
  </div>
  <small class="form-text text-muted">
    Ingrese el número completo y haga clic en Consultar para autocompletar los datos
  </small>
</div>

<div class="form-group mb-2">
  <label>Nombres / Razón Social <span class="text-danger">*</span></label>
  <input
    type="text"
    class="form-control"
    [(ngModel)]="persona.nombre"
    [placeholder]="persona.tipoPersona === 'Proveedor' ? 'Razón Social' : 'Nombres Completos'"
  />
</div>

<div class="form-group mb-2">
  <label>Dirección</label>
  <input
    type="text"
    class="form-control"
    [(ngModel)]="persona.direccion"
    placeholder="Dirección"
  />
</div>

<div class="form-group mb-2">
  <label>Celular / Teléfono</label>
  <input
    type="text"
    class="form-control"
    [(ngModel)]="persona.telefono"
    placeholder="Celular / Teléfono"
  />
</div>

<div class="form-group mb-2">
  <label>Correo</label>
  <input
    type="email"
    class="form-control"
    [(ngModel)]="persona.correo"
    placeholder="Correo electrónico"
  />
</div>

<div class="text-end mt-3">
  <button class="btn btn-secondary me-2" (click)="cancelar()">Cerrar</button>
  <button class="btn btn-primary" (click)="guardar()">
    {{ esEdicion ? 'Actualizar' : 'Registrar' }}
  </button>
</div>

<!-- Overlay de mensaje (éxito o error) -->
<div
  class="overlay-mensaje"
  *ngIf="muestraOverlay"
>
  <div class="mensaje-contenedor border rounded p-4 bg-white shadow">
    <p class="mb-3" [ngClass]="{ 'text-danger': esError, 'text-success': !esError }">
      {{ mensajeOverlay }}
    </p>
    <button class="btn btn-primary" (click)="confirmarOverlay()">
      Aceptar
    </button>
  </div>
</div>
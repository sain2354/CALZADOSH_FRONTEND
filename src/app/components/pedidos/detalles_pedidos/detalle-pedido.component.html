<!-- detalle-pedido.component.html -->
<div class="contenedor-detalle">
  <div class="cabecera-detalle">
    <div class="titulo-y-boleta">
      <h3>Pedido #{{ pedido.idVenta }}</h3>
      <!-- ===================================================== -->
      <!--           NUEVO BOTÓN PARA GENERAR BOLETA           -->
      <!-- ===================================================== -->
      <button (click)="generarBoletaPDF()" class="btn-generar-boleta">
        <i class="fas fa-file-pdf"></i> Generar Boleta de Envío
      </button>
    </div>
    <button (click)="cerrar.emit()" class="btn-cerrar">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Estilos rápidos para el nuevo botón y layout -->
  <style>
    .cabecera-detalle {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .titulo-y-boleta {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .btn-generar-boleta {
      background-color: #28a745; /* Verde éxito */
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-generar-boleta:hover {
      background-color: #218838;
    }
    .btn-generar-boleta .fa-file-pdf {
      font-size: 16px;
    }
  </style>

  <div class="cuerpo-detalle">
    <!-- ... (El resto del contenido permanece igual) ... -->
    
    <section class="datos-envio">
      <h4><i class="fas fa-shipping-fast"></i> Datos para el Envío</h4>
      <div class="info-grid">
        <p><strong>Recibe:</strong> {{ pedido.cliente?.nombreCompleto || 'No especificado' }}</p>
        <p><strong>DNI:</strong> {{ pedido.cliente?.dni || 'No especificado' }}</p>
        <p><strong>Teléfono:</strong> {{ pedido.cliente?.telefono || 'No especificado' }}</p>
      </div>
      <div *ngIf="pedido.direccionEntrega" class="direccion-completa">
        <p><strong>Departamento:</strong> {{ pedido.direccionEntrega.departamento || 'No especificado' }}</p>
        <p><strong>Provincia:</strong> {{ pedido.direccionEntrega.provincia || 'No especificado' }}</p>
        <p><strong>Distrito:</strong> {{ pedido.direccionEntrega.distrito || 'No especificado' }}</p>
        <p><strong>Dirección:</strong> {{ pedido.direccionEntrega.direccion || 'No especificado' }}</p>
        <p><strong>Referencia:</strong> {{ pedido.direccionEntrega.referencia || 'Ninguna' }}</p>
      </div>
      <p *ngIf="!pedido.direccionEntrega"><em>Este pedido no tiene una dirección de entrega especificada.</em></p>
    </section>

    <section class="informacion-pedido">
      <h4><i class="fas fa-shopping-cart"></i> Resumen del Pedido</h4>
      <div class="lista-productos">
        <div class="producto-card" *ngFor="let d of pedido.detalles">
          <img *ngIf="d.imagenUrl" [src]="d.imagenUrl" [alt]="d.nombreProducto" class="producto-imagen" />
          <div class="producto-info">
            <p class="prod-nombre">{{ d.nombreProducto }} (Talla: {{ d.talla }})</p>
            <p><strong>Cantidad:</strong> {{ d.cantidad }}</p>
            <p><strong>Precio Unitario:</strong> S/ {{ d.precio.toFixed(2) }}</p>
          </div>
        </div>
      </div>
      <div class="resumen-pedido">
        <p><strong>Costo Envío:</strong> S/ {{ pedido.costoEnvio.toFixed(2) }}</p>
        <p class="total"><strong>Total Pagado:</strong> S/ {{ pedido.total.toFixed(2) }}</p>
      </div>
    </section>

    <section class="informacion-pago-simple">
        <h4><i class="fas fa-credit-card"></i> Información de Pago</h4>
        <ng-container *ngIf="pedido.pagos.length; else sinPago">
            <div *ngFor="let p of pedido.pagos" class="pago-item-simple">
                <p><strong>Método:</strong> 
                    <span [ngSwitch]="p.idMedioPago">
                        <span *ngSwitchCase="4">Mercado Pago</span>
                        <span *ngSwitchCase="1">Yape</span>
                        <span *ngSwitchCase="2">Plin</span>
                        <span *ngSwitchCase="3">Transferencia</span>
                        <span *ngSwitchDefault>Otro</span>
                    </span>
                </p>
                <p *ngIf="p.idTransaccionMP"><strong>ID Transacción:</strong> {{ p.idTransaccionMP }}</p>
                <p><strong>Fecha de Pago:</strong> {{ formatearFechaIso(p.fechaPago) }}</p>
            </div>
        </ng-container>
        <ng-template #sinPago>
            <p><em>No hay información de pago registrada.</em></p>
        </ng-template>
    </section>

  </div>
</div>

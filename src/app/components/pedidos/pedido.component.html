<div class="contenedor-pedidos">
  <div class="tabla-pedidos">
    <div class="tabla-cabecera">
      <div>ID</div>
      <div>Cliente</div>
      <div>Total</div>
      <div>Método Pago</div>
      <div>Estado Pedido</div>
      <div>Fecha</div>
      <div class="acciones-header">Acciones</div>
    </div>
    <div class="tabla-cuerpo">
      <div *ngFor="let p of pedidos | paginate:{ itemsPerPage: pageSize, currentPage: page }" class="tabla-fila">
        <div>#{{ p.idVenta }}</div>
        
        <div>
          <span *ngIf="cargandoNombres && (!p.cliente || !p.cliente.nombreCompleto || p.cliente.nombreCompleto === '—')">
            Cargando...
          </span>
          <span *ngIf="!cargandoNombres || (p.cliente && p.cliente.nombreCompleto && p.cliente.nombreCompleto !== '—')">
            {{ p.cliente?.nombreCompleto || '—' }}
          </span>
        </div>
        
        <div>S/ {{ p.total.toFixed(2) }}</div>
        
        <div>
          {{ obtenerMetodoPago(p) }}
        </div>
        
        <div>
          <span class="estado-badge" [ngClass]="p.estado.toLowerCase().replace(' ', '-')">
            {{ p.estado }}
          </span>
        </div>
        
        <div>{{ formatearFecha(p.fecha) }}</div>
        
        <div class="acciones-cell">
          <button class="btn-accion" (click)="verDetalle(p)" title="Ver Detalles">
            <i class="fas fa-eye"></i>
          </button>
          <button class="btn-accion" (click)="eliminarPedido(p)" title="Eliminar Pedido">
            <i class="fas fa-trash"></i>
          </button>
          <select class="select-estado" [value]="p.estado" (change)="cambiarEstadoPedido(p, $event)" title="Cambiar Estado">
            <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  
  <pagination-controls (pageChange)="page = $event" [maxSize]="5" [autoHide]="true" class="pagination-wrapper">
  </pagination-controls>
  
  <app-detalle-pedido 
    *ngIf="mostrarDetalle && pedidoSeleccionado" 
    [pedido]="pedidoSeleccionado" 
    (cerrar)="cerrarDetalle()"
    (pagoActualizado)="onPagoActualizado()">
  </app-detalle-pedido>
</div>
<!-- src/app/invoice/invoice.component.html -->
<div id="invoice-print" class="invoice-wrapper" *ngIf="ventaData">

  <!-- NOMBRE DE LA EMPRESA (CENTRADO Y DESTACADO) -->
  <div class="top-company">
    <div class="company-name-top">{{ company.name }}</div>
    <div class="company-legal-top">{{ company.legalName }} — RUC: {{ company.ruc }}</div>
  </div>

  <!-- Top banner (rut / doc) -->
  <div class="top-banner">
    <div class="rut-box">
      <div class="rut-line">R.U.C. : <strong>{{ company.ruc }}</strong></div>
      <div class="doc-title">FACTURA ELECTRÓNICA</div>
      <div class="doc-number-big">Nº: <strong>{{ ventaData.serie || '' }}-{{ ventaData.numeroComprobante || ventaData.numero || '' }}</strong></div>
    </div>
  </div>

  <!-- Header-->
  <header class="inv-header">
    <div class="company-left">
      <img [src]="company.logo" alt="logo" class="logo" onerror="this.style.display='none'"/>
      <div class="company-info">
        <div class="company-meta">{{ company.address }}</div>
        <div class="company-meta small">{{ company.phone }} <span *ngIf="company.phone && company.email">•</span> {{ company.email }}</div>
        <div class="company-meta small">Fecha: {{ ventaData.fechaFormateada || ventaData.fecha || '' }}</div>
      </div>
    </div>

    <div class="doc-right">
      <div class="doc-box">
        <div class="doc-type">{{ (ventaData.tipoComprobante || 'Boleta').toUpperCase() }}</div>
        <div class="doc-number">{{ ventaData.serie || '' }} - {{ ventaData.numeroComprobante || ventaData.numero || '' }}</div>
        <canvas id="barcode-canvas" class="barcode-canvas" aria-hidden="true"></canvas>
      </div>
    </div>
  </header>

  <hr class="section-divider" />

  <!-- Datos cliente -->
  <section class="client-info client-grid">
    <div><strong>Cliente:</strong> {{ ventaData.clienteNombre || '-' }}</div>
    <div><strong>DNI / RUC:</strong> {{ ventaData.clienteDocumento || '-' }}</div>
    <div><strong>Dirección:</strong> {{ ventaData.direccion || '-' }}</div>
    <div><strong>Tel / Cel:</strong> {{ ventaData.celular || ventaData.telefono || '-' }}</div>
    <div><strong>Vendedor:</strong> {{ ventaData.vendedor || '-' }}</div>
    <div><strong>Forma de pago:</strong> {{ ventaData.formaPago || ventaData.metodoPago || '-' }}</div>
    <div *ngIf="ventaData.observaciones" style="grid-column:1 / -1;"><strong>Observaciones:</strong> {{ ventaData.observaciones }}</div>
  </section>

  <hr class="section-divider" />

  <!-- Tabla de items (sin columna VALOR) -->
  <section class="items-table">
    <table>
      <thead>
        <tr>
          <th class="center" style="width:5%;">#</th>
          <th style="width:10%;">EAN</th>
          <th style="width:52%;">DESCRIPCION</th>
          <th class="center" style="width:8%;">CANT</th>
          <th class="right no-wrap" style="width:12%;">P. UNIT.</th>
          <th class="right" style="width:13%;">DESC</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let it of ventaData.detalles; let i = index">
          <td class="center">{{ i + 1 }}</td>
          <td>{{ it.ean || it.codigo || '-' }}</td>
          <td>
            <div class="item-title">{{ it.descripcion || it.nombre }}</div>
            <!-- Mostrar talla si existe -->
            <div class="item-small" *ngIf="it.talla && it.talla !== ''">Talla: {{ it.talla }}</div>
            <div class="item-small" *ngIf="it.extra">{{ it.extra }}</div>
          </td>
          <td class="center">{{ it.cantidad }}</td>
          <td class="right">{{ it.precio | number:'1.2-2' }}</td>
          <!-- VALOR eliminado aquí (antes mostraba it.total) -->
          <td class="right">{{ (it.desc ?? it.descuento ?? 0) | number:'1.2-2' }}</td>
        </tr>
      </tbody>
    </table>
  </section>

  <hr class="section-divider" />

  <!-- Totales -->
  <section class="totals">
    <div class="tot-row"><span>SUB TOTAL</span><span>{{ ventaData.moneda || 'S/' }} {{ getSubTotal() | number:'1.2-2' }}</span></div>
    <div class="tot-row"><span>IGV (18%)</span><span>{{ ventaData.moneda || 'S/' }} {{ getIgv() | number:'1.2-2' }}</span></div>
    <div class="tot-row total"><span>TOTAL</span><span>{{ ventaData.moneda || 'S/' }} {{ getTotal() | number:'1.2-2' }}</span></div>
  </section>

  <!-- QR grande (ÚNICO QR) -->
  <section class="qr-section" style="text-align:center; margin-top:10px;">
    <div id="qrcode-placeholder">
      <img id="qrcode-img" alt="QR" style="display:none; margin:6px auto; width:140px; height:140px; object-fit:contain;" />
    </div>
    <!-- Dejamos espacio para el footer pero forzamos que no se rompa en otra hoja -->
  </section>

  <footer class="inv-footer">
    <div>Gracias por su compra. ¡Vuelva pronto!</div>
    <div style="margin-top:6px; font-size:11px; color:#666;">Documento generado según datos fiscales de la empresa.</div>
  </footer>
</div>
